import os
import numpy as np

from math import sqrt
from zipfile import ZipFile
from PIL import Image

import argparse

from PIL import Image


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument(
        "--name", help="Path to apk file"
    )
    args = parser.parse_args()

    name = None

    with ZipFile(os.path.join('./static', args.name)) as zip:
        name_list = zip.namelist()
        if 'classes.dex' in name_list:
            zip.extract('classes.dex', './static')

    with open('./static/classes.dex', 'rb') as content:
        stream = content.read()

        len_stream = len(stream)
        size = int(sqrt(len_stream)) + 1
        padding = size**2 - len_stream

        img = np.frombuffer(stream, dtype=np.uint8)
        img = np.append(img, [0]*padding)
        img = np.reshape(img, (size, size)).astype(np.uint8)

        img = Image.fromarray(img)
        img.save(os.path.join('./static/dex.jpg'))


